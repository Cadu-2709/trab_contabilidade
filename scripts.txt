-- Apaga tabelas existentes para garantir um começo limpo
DROP TABLE IF EXISTS partidas;
DROP TABLE IF EXISTS lancamentos;
DROP TABLE IF EXISTS contas;

-- Cria as tabelas novamente
CREATE TABLE contas (id SERIAL PRIMARY KEY, id_pai INTEGER REFERENCES contas(id), codigo VARCHAR(20) UNIQUE NOT NULL, nome VARCHAR(255) NOT NULL, tipo VARCHAR(10) NOT NULL CHECK (tipo IN ('SINTETICA', 'ANALITICA')), natureza VARCHAR(10) NOT NULL CHECK (natureza IN ('DEVEDORA', 'CREDORA')));
CREATE TABLE lancamentos (id SERIAL PRIMARY KEY, data DATE NOT NULL, historico TEXT NOT NULL, created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP);
CREATE TABLE partidas (id SERIAL PRIMARY KEY, id_lancamento INTEGER NOT NULL REFERENCES lancamentos(id), id_conta INTEGER NOT NULL REFERENCES contas(id), tipo_partida VARCHAR(1) NOT NULL CHECK (tipo_partida IN ('D', 'C')), valor NUMERIC(15, 2) NOT NULL);

-- INSERINDO O PLANO DE CONTAS COMPLETO (MÉTODO SEGURO COM IDs FIXOS)

-- Nível 1 e 2
INSERT INTO contas (id, id_pai, codigo, nome, tipo, natureza) VALUES
(1, NULL, '1', 'ATIVO', 'SINTETICA', 'DEVEDORA'),
(2, NULL, '2', 'PASSIVO', 'SINTETICA', 'CREDORA'),
(3, NULL, '3', 'PATRIMÔNIO LÍQUIDO', 'SINTETICA', 'CREDORA'),
(4, NULL, '4', 'CONTAS DE RESULTADO', 'SINTETICA', 'DEVEDORA'),
(11, 1, '1.1', 'ATIVO CIRCULANTE', 'SINTETICA', 'DEVEDORA'),
(12, 1, '1.2', 'ATIVO NÃO CIRCULANTE', 'SINTETICA', 'DEVEDORA'),
(21, 2, '2.1', 'PASSIVO CIRCULANTE', 'SINTETICA', 'CREDORA'),
(22, 2, '2.2', 'PASSIVO NÃO CIRCULANTE', 'SINTETICA', 'CREDORA'),
(31, 3, '3.1', 'Capital Social', 'SINTETICA', 'CREDORA'),
(32, 3, '3.2', 'Reservas de Capital', 'SINTETICA', 'CREDORA'),
(33, 3, '3.3', 'Reservas de Lucros', 'SINTETICA', 'CREDORA'),
(34, 3, '3.4', 'Lucros ou Prejuízos Acumulados', 'SINTETICA', 'CREDORA'),
(41, 4, '4.1', 'RECEITAS', 'SINTETICA', 'CREDORA'),
(42, 4, '4.2', 'CUSTOS', 'SINTETICA', 'DEVEDORA'),
(43, 4, '4.3', 'DESPESAS OPERACIONAIS', 'SINTETICA', 'DEVEDORA'),
(44, 4, '4.4', 'RESULTADO FINANCEIRO', 'SINTETICA', 'DEVEDORA'),
(49, 4, '4.9', 'APURAÇÃO DO RESULTADO DO EXERCÍCIO (ARE)', 'SINTETICA', 'DEVEDORA');

-- Nível 3 e Analíticas
-- ATIVO CIRCULANTE (Pai ID: 11)
INSERT INTO contas (id, id_pai, codigo, nome, tipo, natureza) VALUES
(111, 11, '1.1.1', 'Caixa e Equivalentes de Caixa', 'SINTETICA', 'DEVEDORA'),
(11101, 111, '1.1.1.01', 'Caixa Geral', 'ANALITICA', 'DEVEDORA'),
(11102, 111, '1.1.1.02', 'Bancos Conta Movimento', 'ANALITICA', 'DEVEDORA'),
(11103, 111, '1.1.1.03', 'Aplicações Financeiras de Liquidez Imediata', 'ANALITICA', 'DEVEDORA'),
(112, 11, '1.1.2', 'Clientes', 'SINTETICA', 'DEVEDORA'),
(11201, 112, '1.1.2.01', 'Duplicatas a Receber (Mercado Interno)', 'ANALITICA', 'DEVEDORA'),
(11202, 112, '1.1.2.02', 'Duplicatas a Receber (Mercado Externo)', 'ANALITICA', 'DEVEDORA'),
(11203, 112, '1.1.2.03', '(-) Provisão para Créditos de Liquidação Duvidosa (PCLD)', 'ANALITICA', 'CREDORA'),
(113, 11, '1.1.3', 'Estoques', 'SINTETICA', 'DEVEDORA'),
(11301, 113, '1.1.3.01', 'Matérias-Primas', 'ANALITICA', 'DEVEDORA'),
(11302, 113, '1.1.3.02', 'Produtos em Elaboração (ou em Processo)', 'ANALITICA', 'DEVEDORA'),
(11303, 113, '1.1.3.03', 'Produtos Acabados', 'ANALITICA', 'DEVEDORA'),
(11304, 113, '1.1.3.04', 'Materiais de Embalagem', 'ANALITICA', 'DEVEDORA'),
(11305, 113, '1.1.3.05', 'Almoxarifado', 'ANALITICA', 'DEVEDORA'),
(11306, 113, '1.1.3.06', '(-) Provisão para Perdas em Estoque', 'ANALITICA', 'CREDORA'),
(114, 11, '1.1.4', 'Impostos a Recuperar', 'SINTETICA', 'DEVEDORA'),
(11401, 114, '1.1.4.01', 'ICMS a Recuperar', 'ANALITICA', 'DEVEDORA'),
(11402, 114, '1.1.4.02', 'IPI a Recuperar', 'ANALITICA', 'DEVEDORA'),
(11403, 114, '1.1.4.03', 'PIS a Recuperar', 'ANALITICA', 'DEVEDORA'),
(11404, 114, '1.1.4.04', 'COFINS a Recuperar', 'ANALITICA', 'DEVEDORA'),
(115, 11, '1.1.5', 'Despesas Antecipadas', 'SINTETICA', 'DEVEDORA'),
(11501, 115, '1.1.5.01', 'Seguros a Vencer', 'ANALITICA', 'DEVEDORA'),
(11502, 115, '1.1.5.02', 'Aluguéis a Vencer', 'ANALITICA', 'DEVEDORA'),
(11503, 115, '1.1.5.03', 'Assinaturas e Anuidades a Vencer', 'ANALITICA', 'DEVEDORA');

-- ATIVO NÃO CIRCULANTE (Pai ID: 12)
INSERT INTO contas (id, id_pai, codigo, nome, tipo, natureza) VALUES
(121, 12, '1.2.1', 'Realizável a Longo Prazo', 'SINTETICA', 'DEVEDORA'),
(12101, 121, '1.2.1.01', 'Depósitos Judiciais', 'ANALITICA', 'DEVEDORA'),
(12102, 121, '1.2.1.02', 'Empréstimos a Coligadas ou Controladas', 'ANALITICA', 'DEVEDORA'),
(122, 12, '1.2.2', 'Investimentos', 'SINTETICA', 'DEVEDORA'),
(12201, 122, '1.2.2.01', 'Participações Societárias em Outras Empresas', 'ANALITICA', 'DEVEDORA'),
(123, 12, '1.2.3', 'Imobilizado', 'SINTETICA', 'DEVEDORA'),
(12301, 123, '1.2.3.01', 'Terrenos', 'ANALITICA', 'DEVEDORA'),
(12302, 123, '1.2.3.02', 'Edifícios e Construções', 'ANALITICA', 'DEVEDORA'),
(12303, 123, '1.2.3.03', 'Máquinas e Equipamentos Industriais', 'ANALITICA', 'DEVEDORA'),
(12304, 123, '1.2.3.04', 'Veículos', 'ANALITICA', 'DEVEDORA'),
(12305, 123, '1.2.3.05', 'Móveis e Utensílios', 'ANALITICA', 'DEVEDORA'),
(12306, 123, '1.2.3.06', 'Ferramentas', 'ANALITICA', 'DEVEDORA'),
(12307, 123, '1.2.3.07', 'Equipamentos de Informática', 'ANALITICA', 'DEVEDORA'),
(12308, 123, '1.2.3.08', '(-) Depreciação Acumulada', 'ANALITICA', 'CREDORA'),
(124, 12, '1.2.4', 'Intangível', 'SINTETICA', 'DEVEDORA'),
(12401, 124, '1.2.4.01', 'Marcas e Patentes', 'ANALITICA', 'DEVEDORA'),
(12402, 124, '1.2.4.02', 'Softwares e Licenças de Uso', 'ANALITICA', 'DEVEDORA'),
(12403, 124, '1.2.4.03', '(-) Amortização Acumulada', 'ANALITICA', 'CREDORA');

-- PASSIVO CIRCULANTE (Pai ID: 21)
INSERT INTO contas (id, id_pai, codigo, nome, tipo, natureza) VALUES
(211, 21, '2.1.1', 'Fornecedores', 'SINTETICA', 'CREDORA'),
(21101, 211, '2.1.1.01', 'Fornecedores Nacionais', 'ANALITICA', 'CREDORA'),
(21102, 211, '2.1.1.02', 'Fornecedores Estrangeiros', 'ANALITICA', 'CREDORA'),
(212, 21, '2.1.2', 'Obrigações Trabalhistas', 'SINTETICA', 'CREDORA'),
(21201, 212, '2.1.2.01', 'Salários a Pagar', 'ANALITICA', 'CREDORA'),
(21202, 212, '2.1.2.02', 'Férias a Pagar', 'ANALITICA', 'CREDORA'),
(21203, 212, '2.1.2.03', '13º Salário a Pagar', 'ANALITICA', 'CREDORA'),
(21204, 212, '2.1.2.04', 'INSS a Recolher', 'ANALITICA', 'CREDORA'),
(21205, 212, '2.1.2.05', 'FGTS a Recolher', 'ANALITICA', 'CREDORA'),
(213, 21, '2.1.3', 'Obrigações Tributárias', 'SINTETICA', 'CREDORA'),
(21301, 213, '2.1.3.01', 'ICMS a Recolher', 'ANALITICA', 'CREDORA'),
(21302, 213, '2.1.3.02', 'IPI a Recolher', 'ANALITICA', 'CREDORA'),
(21303, 213, '2.1.3.03', 'PIS a Recolher', 'ANALITICA', 'CREDORA'),
(21304, 213, '2.1.3.04', 'COFINS a Recolher', 'ANALITICA', 'CREDORA'),
(21305, 213, '2.1.3.05', 'IRPJ a Pagar', 'ANALITICA', 'CREDORA'),
(21306, 213, '2.1.3.06', 'CSLL a Pagar', 'ANALITICA', 'CREDORA'),
(214, 21, '2.1.4', 'Empréstimos e Financiamentos (Curto Prazo)', 'SINTETICA', 'CREDORA'),
(21401, 214, '2.1.4.01', 'Financiamentos Bancários', 'ANALITICA', 'CREDORA'),
(215, 21, '2.1.5', 'Outras Obrigações', 'SINTETICA', 'CREDORA'),
(21501, 215, '2.1.5.01', 'Contas de Energia, Água e Telefone a Pagar', 'ANALITICA', 'CREDORA'),
(21502, 215, '2.1.5.02', 'Aluguéis a Pagar', 'ANALITICA', 'CREDORA');

-- PASSIVO NÃO CIRCULANTE (Pai ID: 22)
INSERT INTO contas (id, id_pai, codigo, nome, tipo, natureza) VALUES
(221, 22, '2.2.1', 'Empréstimos e Financiamentos (Longo Prazo)', 'SINTETICA', 'CREDORA'),
(22101, 221, '2.2.1.01', 'Financiamentos Bancários (LP)', 'ANALITICA', 'CREDORA'),
(22102, 221, '2.2.1.02', 'Financiamentos para Aquisição de Imobilizado', 'ANALITICA', 'CREDORA'),
(222, 22, '2.2.2', 'Provisões', 'SINTETICA', 'CREDORA'),
(22201, 222, '2.2.2.01', 'Provisão para Contingências Trabalhistas', 'ANALITICA', 'CREDORA'),
(22202, 222, '2.2.2.02', 'Provisão para Contingências Fiscais', 'ANALITICA', 'CREDORA');

-- PATRIMÔNIO LÍQUIDO (Pais ID: 31, 32, 33, 34)
INSERT INTO contas (id, id_pai, codigo, nome, tipo, natureza) VALUES
(311, 31, '3.1.1.01', 'Capital Social Subscrito', 'ANALITICA', 'CREDORA'),
(312, 31, '3.1.1.02', '(-) Capital a Integralizar', 'ANALITICA', 'DEVEDORA'),
(321, 32, '3.2.1.01', 'Ágio na Emissão de Ações', 'ANALITICA', 'CREDORA'),
(331, 33, '3.3.1.01', 'Reserva Legal', 'ANALITICA', 'CREDORA'),
(332, 33, '3.3.1.02', 'Reserva Estatutária', 'ANALITICA', 'CREDORA'),
(341, 34, '3.4.1.01', 'Lucros Acumulados', 'ANALITICA', 'CREDORA'),
(342, 34, '3.4.1.02', '(-) Prejuízos Acumulados', 'ANALITICA', 'DEVEDORA');

-- CONTAS DE RESULTADO
-- RECEITAS (Pai ID: 41)
INSERT INTO contas (id, id_pai, codigo, nome, tipo, natureza) VALUES
(411, 41, '4.1.1', 'Receita Operacional Bruta', 'SINTETICA', 'CREDORA'),
(41101, 411, '4.1.1.01', 'Venda de Produtos Industrializados', 'ANALITICA', 'CREDORA'),
(412, 41, '4.1.2', '(-) Deduções da Receita Bruta', 'SINTETICA', 'DEVEDORA'),
(41201, 412, '4.1.2.01', 'Devoluções de Vendas', 'ANALITICA', 'DEVEDORA'),
(41202, 412, '4.1.2.02', 'Abatimentos sobre Vendas', 'ANALITICA', 'DEVEDORA'),
(41203, 412, '4.1.2.03', 'ICMS sobre Vendas', 'ANALITICA', 'DEVEDORA'),
(41204, 412, '4.1.2.04', 'IPI sobre Vendas', 'ANALITICA', 'DEVEDORA'),
(41205, 412, '4.1.2.05', 'PIS sobre Faturamento', 'ANALITICA', 'DEVEDORA'),
(41206, 412, '4.1.2.06', 'COFINS sobre Faturamento', 'ANALITICA', 'DEVEDORA');

-- CUSTOS (Pai ID: 42)
INSERT INTO contas (id, id_pai, codigo, nome, tipo, natureza) VALUES
(421, 42, '4.2.1', 'Custo dos Produtos Vendidos (CPV)', 'SINTETICA', 'DEVEDORA'),
(42101, 421, '4.2.1.01', 'Custo de Matéria-Prima Consumida', 'ANALITICA', 'DEVEDORA'),
(42102, 421, '4.2.1.02', 'Custo de Mão de Obra Direta (MOD)', 'ANALITICA', 'DEVEDORA'),
(42103, 421, '4.2.1.03', 'Custos Indiretos de Fabricação (CIF)', 'ANALITICA', 'DEVEDORA');

-- DESPESAS OPERACIONAIS (Pai ID: 43)
INSERT INTO contas (id, id_pai, codigo, nome, tipo, natureza) VALUES
(431, 43, '4.3.1', 'Despesas com Vendas', 'SINTETICA', 'DEVEDORA'),
(43101, 431, '4.3.1.01', 'Salários e Comissões de Vendedores', 'ANALITICA', 'DEVEDORA'),
(43102, 431, '4.3.1.02', 'Marketing e Publicidade', 'ANALITICA', 'DEVEDORA'),
(43103, 431, '4.3.1.03', 'Fretes e Carretos sobre Vendas', 'ANALITICA', 'DEVEDORA'),
(432, 43, '4.3.2', 'Despesas Administrativas', 'SINTETICA', 'DEVEDORA'),
(43201, 432, '4.3.2.01', 'Salários e Encargos do Pessoal Administrativo', 'ANALITICA', 'DEVEDORA'),
(43202, 432, '4.3.2.02', 'Aluguel do Escritório', 'ANALITICA', 'DEVEDORA'),
(43203, 432, '4.3.2.03', 'Honorários (Contador, Advogado)', 'ANALITICA', 'DEVEDORA'),
(43204, 432, '4.3.2.04', 'Material de Escritório', 'ANALITICA', 'DEVEDORA'),
(43205, 432, '4.3.2.05', 'Depreciação de Ativos Administrativos', 'ANALITICA', 'DEVEDORA'),
(43206, 432, '4.3.2.06', 'Viagens e Representações', 'ANALITICA', 'DEVEDORA');

-- RESULTADO FINANCEIRO (Pai ID: 44)
INSERT INTO contas (id, id_pai, codigo, nome, tipo, natureza) VALUES
(441, 44, '4.4.1', 'Receitas Financeiras', 'SINTETICA', 'CREDORA'),
(44101, 441, '4.4.1.01', 'Juros Ativos', 'ANALITICA', 'CREDORA'),
(44102, 441, '4.4.1.02', 'Variações Cambiais Ativas', 'ANALITICA', 'CREDORA'),
(442, 44, '4.4.2', 'Despesas Financeiras', 'SINTETICA', 'DEVEDORA'),
(44201, 442, '4.4.2.01', 'Juros Passivos', 'ANALITICA', 'DEVEDORA'),
(44202, 442, '4.4.2.02', 'Variações Cambiais Passivas', 'ANALITICA', 'DEVEDORA'),
(44203, 442, '4.4.2.03', 'Despesas Bancárias', 'ANALITICA', 'DEVEDORA');

-- ARE (Pai ID: 49)
INSERT INTO contas (id, id_pai, codigo, nome, tipo, natureza) VALUES
(491, 49, '4.9.1.01', 'Conta Transitória para Apuração do Lucro ou Prejuízo', 'ANALITICA', 'DEVEDORA');

-- Ajusta a sequência dos IDs para evitar conflitos futuros
SELECT setval('contas_id_seq', (SELECT MAX(id) FROM contas));